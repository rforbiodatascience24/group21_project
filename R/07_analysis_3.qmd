---
title: "07_analysis_3"
author:
- "Asta Zeuner - s203544 - azeuner"
- "Astrid Ginnerup - s203523 - AGinnerup"
- "Emma Dan√∏ - s203564 - EDanoe"
- "Andrea Kristensen - s193769 - AndreaMTK"
- "Yayi Wang - s243554 - Yayi0117"
html: 
    embed-resources: true
execute: 
  message: FALSE
  warning: FALSE
---

-   make some descriptive plots eg. facet wrap

-   survival vs alcohol and smoking

-   vital_status vs tissue_source_location

-   ethnicity

-   gender overall survival

## **Loading libraries**

```{r}
#| label: "load-libraries" 
#| echo: TRUE
#| eval: TRUE 
#| output: FALSE  
#| 
library("ggplot2")
#library("colorspace")
```

Loading data

```{r}
#| label: "load-data" 

expression_meta_data_aug <- read_tsv(file = here("data/04_expression_meta_data_aug.tsv.gz"))

```

## Plot with gender and overall survival

add absolute numbers

change axis titles from count

```{r}


  #summarize(total = n(),groups = "keep")





barplot_vital_status_genders<-ggplot(data = expression_meta_data_aug,
       mapping = aes(x = gender,
                     fill = vital_status
                     ))+
  
  geom_bar(color = "powderblue",
           position = "fill")+
  

  
  
  scale_fill_brewer(palette = "Pastel2")+
  labs(x = "Gender", 
       y = "Proportion",
       title = "Distribution of Gender and Vital Status",
       subtitle = "Proportional representation by Gender and Race",
       fill = "Vital Status"
       )+
  
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "right"
        )+
  theme_classic()


barplot_vital_status_genders  

ggsave("~/projects/group_21_project/results/images/barplot_vital_status_genders.png", plot= last_plot())








```

Facet wrap with ethnicity and survival

add absolute values

```{r}
barplot_vital_status_genders_facet_races<-ggplot(data = expression_meta_data_aug,
       mapping = aes(x = gender,
                     fill = vital_status
                     ))+
  geom_bar(color = "powderblue",
           position = "fill"
           )+
  scale_fill_brewer(palette = "Pastel2")+
  facet_wrap(~race)+
  labs(x = "Gender", 
       y = "Proportion",
       title = "Distribution of Gender and Vital Status Across Races",
          subtitle = "Proportional representation by gender and race",
       fill = "Vital Status") +
  
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        strip.text = element_text(size = 6, face = "bold"))+
  theme_classic()


ggsave("~/projects/group_21_project/results/images/barplot_vital_status_genders_facet_races.png", plot= last_plot())

```

```{r}

boxplot_years_smoked_vital_status_facet_pathological<-expression_meta_data_aug |> 
  drop_na(pathologic_stage) |> 
ggplot(mapping = aes(x = vital_status,
                     y = years_smoked))+
geom_boxplot(color = "lawngreen",
             fill = "seagreen3")+
  facet_wrap(~pathologic_stage)+
  labs(x = "Vital Status", 
       y = "Years smoked",
       title = "Distribution of Years smoked and Vital Status Across pathological stages",
       fill = "Vital Status")+
  theme(plot.title = element_text(size = 10, hjust = 0.5))+
  theme_classic()


boxplot_years_smoked_vital_status_facet_pathological

ggsave("~/projects/group_21_project/results/images/boxplot_years_smoked_vital_status_facet_pathological.png", plot= last_plot())

```

Apparently, no patients are recorded with years smoked = 0. We assume they are registered as NA although NA could also refer to the fact that the patients did not respond.

The 6 most differentially expressed genes sorted on different ages

```{r}

expression_of_6_significant_pep_and_vital_status<-expression_meta_data_aug |> 
  filter(peptide_target %in% c("Notch3", "FIBRONECTIN", "MERIT40_pS29","Enolase-2","PKC-a-b-II_pT638_T641","IMP3")) |> 
  
  ggplot(mapping = aes(x = age_at_index,
                       y = expression,
                       fill = vital_status,
                       color = vital_status
                      ))+
  geom_point( shape = 8,
              size = 1)+
  
  scale_fill_brewer(palette = "Pastel2")+
  
  labs(x = "Age", 
       y = "Expression level"
       )+
  
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "right"
        )+
  
  facet_wrap(~peptide_target)+
  theme_classic()


expression_of_6_significant_pep_and_vital_status

ggsave("~/projects/group_21_project/results/images/expression_of_6_significant_pep_and_vital_status.png", plot= last_plot())

```
